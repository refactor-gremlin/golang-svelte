{
  "name": "Svelte + .NET Dev Container",
  "dockerComposeFile": ["docker-compose.yml"],
  "service": "app",
  "workspaceFolder": "/workspace",

  "runServices": ["api", "web", "db", "loki", "grafana", "jaeger", "promtail"],

  "forwardPorts": [5173, 7216, 5432, 3000, 3100, 16686],
  "portsAttributes": {
    "5173": { "label": "Svelte Client", "onAutoForward": "openBrowser" },
    "7216": { "label": "ASP.NET Core API", "onAutoForward": "openBrowser" },
    "3000": { "label": "Grafana", "onAutoForward": "openBrowser" },
    "3100": { "label": "Loki HTTP", "onAutoForward": "openBrowser" },
    "16686": { "label": "Jaeger UI", "onAutoForward": "openBrowser" }
  },

  "features": {
    "ghcr.io/devcontainers/features/node:1": {
      "version": "22",
      "nodeGypDependencies": true
    },
    "ghcr.io/devcontainers/features/docker-outside-of-docker:1": {}
  },
  "mounts": [
    "source=/var/run/docker.sock,target=/var/run/docker.sock,type=bind"
  ],

  "customizations": {
    "vscode": {
      "extensions": [
        "nromanov.dotrush",
        "bradlc.vscode-tailwindcss"
      ],
      "settings": {
        "terminal.integrated.defaultProfile.linux": "zsh"
      }
    }
  },

  "remoteUser": "vscode",

  // Ensures the "vscode" user UID/GID inside the container matches your host user.
  // Prevents EACCES on bind mounts like /workspace.
  "updateRemoteUserUID": true,

  // First ensure the workspace is owned by vscode (uid/gid=1000 usually),
  // then install client deps and restore .NET.
  "postCreateCommand": "sudo chown -R vscode:vscode /workspace && npm ci --prefix MySvelteApp.Client && dotnet restore && npm install --global @ast-grep/cli"
}
